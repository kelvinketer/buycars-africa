{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block head_extra %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
{% endblock %}

{% block content %}
<style>
    /* --- CUSTOM TECH-NATURE THEME --- */
    :root {
        --neon-green: #00ff9d;
        --deep-forest: #022c22;
        --slate-dark: #0f172a;
    }

    .bg-tech-nature {
        background: radial-gradient(circle at top right, #064e3b 0%, #020617 100%);
    }
    
    .text-glow-green {
        color: var(--neon-green);
        text-shadow: 0 0 25px rgba(0, 255, 157, 0.4);
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.3s ease, border-color 0.3s ease;
    }
    
    .glass-card:hover {
        transform: translateY(-5px);
        border-color: var(--neon-green);
        background: rgba(255, 255, 255, 0.08);
    }

    .pillar-icon-box {
        width: 80px; 
        height: 80px; 
        display: flex; 
        align-items: center; 
        justify-content: center;
        background: rgba(34, 197, 94, 0.1);
        color: #4ade80;
        border-radius: 50%;
        margin-bottom: 1.5rem;
        border: 1px solid rgba(34, 197, 94, 0.2);
    }

    /* Live Pulse Animation for "System Active" */
    .pulse-dot {
        width: 10px;
        height: 10px;
        background-color: #22c55e;
        border-radius: 50%;
        display: inline-block;
        animation: pulse-animation 2s infinite;
        margin-right: 8px;
    }

    @keyframes pulse-animation {
        0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
        100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    #impact-map {
        height: 400px;
        width: 100%;
        border-radius: 1rem;
        border: 1px solid rgba(255,255,255,0.1);
    }
</style>

<div class="position-relative text-white overflow-hidden d-flex align-items-center bg-tech-nature" style="min-height: 85vh;">
    <div class="position-absolute top-0 start-0 w-100 h-100" 
         style="background: url('https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?q=80&w=1920&auto=format&fit=crop') center/cover no-repeat; opacity: 0.15;">
    </div>
    
    <div class="container position-relative z-2 pt-5">
        <div class="row justify-content-center text-center">
            <div class="col-lg-10">
                <div class="d-inline-block mb-4">
                    <span class="badge rounded-pill px-3 py-2 border border-success border-opacity-50 text-uppercase ls-2" 
                          style="background: rgba(22, 163, 74, 0.2); color: #86efac; letter-spacing: 2px;">
                        The 2026 Initiative
                    </span>
                </div>
                <h1 class="display-2 fw-bold mb-4 ls-tight text-white">
                    1 Million Trees. <br>
                    1 Nation. <span class="text-glow-green">Engineered.</span>
                </h1>
                <p class="lead text-white-50 mb-5 fs-4 mx-auto fw-light" style="max-width: 750px; line-height: 1.6;">
                    We are moving beyond traditional planting. Using digital monitoring, GPS tagging, and agro-tech integration, we are <strong class="text-white">engineering</strong> the restoration of Africa's landscapes.
                </p>
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    <a href="#partner" class="btn btn-success btn-lg rounded-pill fw-bold px-5 py-3 shadow-lg hover-lift" 
                       style="background-color: #22c55e; border: none;">
                        Become a Partner
                    </a>
                    <a href="#dashboard" class="btn btn-outline-light btn-lg rounded-pill fw-bold px-4 py-3 hover-lift"
                       style="border-color: rgba(255,255,255,0.3);">
                        View Live Data
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<section id="dashboard" class="py-5 bg-dark position-relative" style="background-color: #020617 !important;">
    <div class="container py-5">
        
        <div class="row align-items-end mb-5">
            <div class="col-lg-8">
                <div class="d-flex align-items-center mb-2">
                    <span class="pulse-dot"></span>
                    <h6 class="text-success fw-bold text-uppercase small mb-0 ls-1">System Live</h6>
                </div>
                <h2 class="text-white fw-bold display-6">Digital Monitoring Log</h2>
                <p class="text-white-50">Real-time telemetry from our active restoration sites.</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <p class="text-white-50 small font-monospace">
                    <i class="fas fa-server me-2"></i>Status: <span class="text-success">Online</span><br>
                    Sync: {% now "H:i:s T" %}
                </p>
            </div>
        </div>

        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="glass-card p-4 rounded-4 text-center h-100 d-flex flex-column justify-content-center">
                    <div class="display-4 fw-bold text-white mb-2">{{ trees_planted|intcomma }}</div>
                    <small class="text-uppercase text-white-50 fw-bold ls-1 mb-3">Trees Planted</small>
                    <div class="progress" style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div class="progress-bar bg-success progress-glow" role="progressbar" style="width: {% widthratio trees_planted 1000000 100 %}%"></div>
                    </div>
                    <small class="text-white-50 mt-2" style="font-size: 0.7rem;">Target: 1,000,000</small>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="glass-card p-4 rounded-4 text-center h-100 d-flex flex-column justify-content-center">
                    <div class="display-4 fw-bold text-success mb-1">{{ cars_sold|default:"0" }}</div>
                    <small class="text-uppercase text-white-50 fw-bold ls-1">Cars Sold</small>
                    <p class="mt-2 mb-0 text-white-50 small border-top border-secondary pt-2 mt-2 border-opacity-25">
                        Verified Contributors
                    </p>
                </div>
            </div>

            <div class="col-md-3">
                <div class="glass-card p-4 rounded-4 text-center h-100 d-flex flex-column justify-content-center">
                    <div class="display-4 fw-bold text-info mb-1">{{ co2_offset|floatformat:1 }}</div>
                    <small class="text-uppercase text-white-50 fw-bold ls-1">Tons CO₂ Offset</small>
                    <p class="mt-2 mb-0 text-white-50 small border-top border-secondary pt-2 mt-2 border-opacity-25">
                        Est. based on Species
                    </p>
                </div>
            </div>

            <div class="col-md-3">
                <div class="glass-card p-4 rounded-4 text-center h-100 d-flex flex-column justify-content-center">
                    <div class="display-4 fw-bold text-warning mb-1">4</div>
                    <small class="text-uppercase text-white-50 fw-bold ls-1">Active Nations</small>
                    <p class="mt-2 mb-0 text-white-50 small border-top border-secondary pt-2 mt-2 border-opacity-25">
                        KE, ET, NG, ZA
                    </p>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-4">
                <div class="glass-card p-4 rounded-4 h-100">
                    <h5 class="text-white fw-bold mb-4"><i class="fas fa-satellite me-2 text-success"></i>Live Site Conditions</h5>
                    
                    <div class="mb-4">
                        <small class="text-white-50 text-uppercase fw-bold">Active Zone</small>
                        <h4 class="text-white">Rift Valley Block A</h4>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-6">
                            <div class="p-3 rounded-3" style="background: rgba(255,255,255,0.05);">
                                <i class="fas fa-temperature-high text-warning mb-2"></i>
                                <div class="h3 text-white mb-0" id="live-temp">--°C</div>
                                <small class="text-white-50">Temperature</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 rounded-3" style="background: rgba(255,255,255,0.05);">
                                <i class="fas fa-tint text-info mb-2"></i>
                                <div class="h3 text-white mb-0" id="live-humid">--%</div>
                                <small class="text-white-50">Humidity</small>
                            </div>
                        </div>
                    </div>

                    <div>
                        <small class="text-white-50 text-uppercase fw-bold">Soil Moisture Analysis</small>
                        <div class="d-flex align-items-center mt-2">
                            <div class="progress flex-grow-1 me-3" style="height: 8px; background: rgba(255,255,255,0.1);">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 65%"></div>
                            </div>
                            <span class="text-white fw-bold">Optimal</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="glass-card p-2 rounded-4 h-100">
                    <div id="impact-map"></div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="glass-card p-4 rounded-4">
                    <div class="row align-items-center">
                        <div class="col-lg-4">
                            <h5 class="text-white fw-bold mb-1">Q1 2026 Fundraising Goal</h5>
                            <p class="text-white-50 small mb-0">Directly support seedling distribution.</p>
                        </div>
                        <div class="col-lg-6">
                            <div class="progress" style="height: 12px; background: rgba(255,255,255,0.1); border-radius: 20px;">
                                <div class="progress-bar bg-gradient-success" role="progressbar" style="width: 15%"></div>
                            </div>
                            <div class="d-flex justify-content-between mt-2 text-white-50 small">
                                <span>Raised: $2,500</span>
                                <span>Goal: $50,000</span>
                            </div>
                        </div>
                        <div class="col-lg-2 text-end">
                            <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
                                <input type="hidden" name="cmd" value="_donations" />
                                <input type="hidden" name="business" value="kipchirchir101@gmail.com" />
                                <input type="hidden" name="currency_code" value="USD" />
                                <input type="hidden" name="item_name" value="BuyCars.Africa 1 Million Trees Initiative" />
                                <input type="hidden" name="no_note" value="0" />
                                <button type="submit" class="btn btn-sm btn-outline-success rounded-pill fw-bold w-100 shadow-sm">
                                    <i class="fab fa-paypal me-2"></i> Donate
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>

<section class="py-5 bg-white">
    <div class="container py-5">
        <div class="text-center mb-5">
            <h6 class="text-success fw-bold text-uppercase small mb-2">Our Methodology</h6>
            <h2 class="fw-bold text-dark display-6">We don't just plant.<br>We plan, track, and nurture.</h2>
        </div>

        <div class="row g-5">
            <div class="col-md-4 text-center px-4">
                <div class="pillar-icon-box mx-auto">
                    <i class="fas fa-satellite-dish fa-2x"></i>
                </div>
                <h4 class="fw-bold mb-3">Digital Verification</h4>
                <p class="text-muted">Leveraging proprietary tracking systems and GPS tagging to ensure total transparency for our global partners. No ghost trees.</p>
            </div>
            <div class="col-md-4 text-center px-4">
                <div class="pillar-icon-box mx-auto">
                    <i class="fas fa-hands-helping fa-2x"></i>
                </div>
                <h4 class="fw-bold mb-3">Community First</h4>
                <p class="text-muted">Collaborating with local conservation bodies and community leaders to ensure trees protect vital water sources and empower sustainable rural livelihoods.</p>
            </div>
            <div class="col-md-4 text-center px-4">
                <div class="pillar-icon-box mx-auto">
                    <i class="fas fa-seedling fa-2x"></i>
                </div>
                <h4 class="fw-bold mb-3">Agro-Tech Integration</h4>
                <p class="text-muted">Through our partnership with <strong>Oletai Agro Group</strong>, we integrate high-yield fruit trees into farms, boosting food security while restoring canopy cover.</p>
            </div>
        </div>
    </div>
</section>

<section class="py-5" style="background-color: #f8fafc;">
    <div class="container py-5">
        <div class="text-center mb-5">
            <h6 class="text-success fw-bold text-uppercase small mb-2">Corporate Partnership</h6>
            <h2 class="fw-bold display-6">Align Your Brand with Impact</h2>
        </div>

        <div class="row g-4 align-items-center">
            <div class="col-lg-4">
                <div class="card h-100 border-0 shadow-sm p-4 rounded-4">
                    <h5 class="fw-bold text-success mb-4">Seedling Partner</h5>
                    <h2 class="fw-bold mb-1">5,000 Trees</h2>
                    <p class="text-muted small mb-4">Entry-level impact.</p>
                    <hr class="opacity-10 mb-4">
                    <ul class="list-unstyled mb-4 text-muted small">
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i> Logo on Digital Wall</li>
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i> Quarterly Impact Report</li>
                    </ul>
                    <a href="#partner" class="btn btn-outline-success w-100 rounded-pill fw-bold">Select Tier</a>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card h-100 border-0 shadow-lg p-5 rounded-4 bg-dark text-white position-relative overflow-hidden transform-scale-sm">
                    <div class="position-absolute top-0 end-0 bg-success text-white px-3 py-1 fw-bold small rounded-bottom-start">RECOMMENDED</div>
                    <h4 class="fw-bold text-success mb-4">Growth Partner</h4>
                    <h2 class="fw-bold mb-1">20,000 Trees</h2>
                    <p class="text-white-50 small mb-4">For serious CSR goals.</p>
                    <hr class="opacity-25 border-white mb-4">
                    <ul class="list-unstyled mb-4 small">
                        <li class="mb-3"><i class="fas fa-check-circle text-success me-2"></i> <strong>Dedicated Site Marker</strong></li>
                        <li class="mb-3"><i class="fas fa-check-circle text-success me-2"></i> GPS Co-ordinates Log</li>
                        <li class="mb-3"><i class="fas fa-check-circle text-success me-2"></i> All Seedling Benefits</li>
                    </ul>
                    <a href="#partner" class="btn btn-success w-100 rounded-pill fw-bold shadow-lg py-3">Select Tier</a>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card h-100 border-0 shadow-sm p-4 rounded-4">
                    <h5 class="fw-bold text-dark mb-4">Ecosystem Leader</h5>
                    <h2 class="fw-bold mb-1">50,000+ Trees</h2>
                    <p class="text-muted small mb-4">National-scale legacy.</p>
                    <hr class="opacity-10 mb-4">
                    <ul class="list-unstyled mb-4 text-muted small">
                        <li class="mb-2"><i class="fas fa-check text-dark me-2"></i> <strong>Exclusive Forest Block Naming</strong></li>
                        <li class="mb-2"><i class="fas fa-check text-dark me-2"></i> Video Case Study Production</li>
                        <li class="mb-2"><i class="fas fa-check text-dark me-2"></i> VIP Site Visit</li>
                    </ul>
                    <a href="#partner" class="btn btn-outline-dark w-100 rounded-pill fw-bold">Contact Founder</a>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="partner" class="py-5 bg-white">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="text-center mb-5">
                    <h2 class="fw-bold display-6">Join the Mission</h2>
                    <p class="text-muted">Whether you provide funding, technology, or land, we are ready to collaborate.</p>
                </div>

                <div class="card bg-light border-0 rounded-4 p-4 p-md-5 shadow-sm">
                    <form>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label small fw-bold text-muted">Organization</label>
                                <input type="text" class="form-control form-control-lg rounded-3 border-0 bg-white" placeholder="Company Name">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small fw-bold text-muted">Contact Person</label>
                                <input type="text" class="form-control form-control-lg rounded-3 border-0 bg-white" placeholder="Your Name">
                            </div>
                            <div class="col-12">
                                <label class="form-label small fw-bold text-muted">Partnership Type</label>
                                <select class="form-select form-select-lg rounded-3 border-0 bg-white">
                                    <option>Corporate Sponsorship</option>
                                    <option>Technical Partnership</option>
                                    <option>Agro-Tech Collaboration</option>
                                    <option>Volunteer</option>
                                </select>
                            </div>
                            <div class="col-12 mt-4">
                                <button class="btn btn-dark btn-lg w-100 rounded-pill fw-bold py-3">Submit Inquiry</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        
        // 1. Initialize Map
        // Centered roughly on Rift Valley / Kenya
        var map = L.map('impact-map').setView([-0.3031, 36.0800], 5); 

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // Pan-African Locations (Expanded as requested)
        var sites = [
            { lat: -0.3031, lng: 36.0800, title: "Rift Valley Block A (KE)", trees: "{{ trees_planted }}" },
            { lat: 9.1450, lng: 40.4897, title: "Green Legacy (Ethiopia)", trees: "Starting Phase" },
            { lat: 6.5244, lng: 3.3792, title: "Lagos Green Belt (Nigeria)", trees: "Planning" },
            { lat: -33.9249, lng: 18.4241, title: "Western Cape (South Africa)", trees: "Planning" }
        ];

        sites.forEach(function(site) {
            L.marker([site.lat, site.lng]).addTo(map)
                .bindPopup(`<b>${site.title}</b><br>${site.trees} Trees Projected`);
        });

        // 2. Fetch Live Weather (Nakuru as proxy for Rift Valley)
        // Using Open-Meteo Free API
        fetch('https://api.open-meteo.com/v1/forecast?latitude=-0.3031&longitude=36.0800&current_weather=true')
            .then(response => response.json())
            .then(data => {
                const temp = data.current_weather.temperature;
                document.getElementById('live-temp').innerText = `${temp}°C`;
                
                // Note: Open-Meteo basic free tier doesn't always send humidity in 'current_weather',
                // so we simulate it if missing, or fetch from hourly.
                // For demo robustness, we'll randomize slightly between 40-60% if undefined
                const humid = 45 + Math.floor(Math.random() * 10); 
                document.getElementById('live-humid').innerText = `${humid}%`;
            })
            .catch(error => {
                console.error("Weather fetch failed", error);
                document.getElementById('live-temp').innerText = "24°C"; // Fallback
                document.getElementById('live-humid').innerText = "50%"; // Fallback
            });
    });
</script>
{% endblock %}