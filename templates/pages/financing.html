{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="py-5" style="background-color: #0f172a; color: white;">
    <div class="container py-5">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <span class="badge bg-warning text-dark mb-3 px-3 py-2 rounded-pill fw-bold">
                    <i class="fas fa-bolt me-2"></i>Fast-Track Approval
                </span>
                <h1 class="display-4 fw-bold mb-3">Drive Now.<br><span class="text-success">Pay Later.</span></h1>
                <p class="lead opacity-75 mb-4">
                    Stop saving for years. Leverage our partnerships with Africa's leading Saccos and Banks to unlock up to <strong>80% Asset Financing</strong> today.
                </p>
                <div class="d-flex gap-3">
                    <a href="#calculator" class="btn btn-outline-light rounded-pill px-4 fw-bold">Calculate Repayments</a>
                    <a href="#apply" class="btn btn-success rounded-pill px-4 fw-bold shadow-lg">Get Pre-Approved</a>
                </div>
            </div>
            <div class="col-lg-6 mt-5 mt-lg-0 text-center">
                <img src="https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?q=80&w=1000&auto=format&fit=crop" 
                     class="img-fluid rounded-4 shadow-lg border border-secondary" 
                     alt="Financial Growth" style="max-height: 400px; opacity: 0.9;">
            </div>
        </div>
    </div>
</section>

<section id="calculator" class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                    <div class="card-body p-5">
                        <div class="text-center mb-5">
                            <h6 class="text-danger fw-bold text-uppercase small ls-2">Planning Tool</h6>
                            <h2 class="fw-bold text-dark">Loan Calculator</h2>
                            <p class="text-muted">Estimate your monthly repayments instantly.</p>
                        </div>

                        <div class="row g-5">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small">Vehicle Price (KES)</label>
                                <input type="number" id="carPrice" class="form-control form-control-lg mb-4 bg-light fw-bold" value="1500000" oninput="calculateLoan()">
                                
                                <label class="form-label fw-bold text-muted small">Deposit (Min 20%)</label>
                                <input type="number" id="deposit" class="form-control form-control-lg mb-4 bg-light fw-bold" value="300000" oninput="calculateLoan()">
                                
                                <label class="form-label fw-bold text-muted small">Repayment Period</label>
                                <input type="range" class="form-range" id="months" min="12" max="60" step="6" value="36" oninput="updateMonthsLabel(); calculateLoan()">
                                <div class="d-flex justify-content-between small fw-bold text-danger">
                                    <span>12 Months</span>
                                    <span id="monthsLabel" class="text-dark">36 Months</span>
                                    <span>60 Months</span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="bg-dark text-white rounded-4 p-4 h-100 d-flex flex-column justify-content-center text-center position-relative overflow-hidden">
                                    <div class="position-absolute top-0 start-0 w-100 h-100 bg-gradient-primary opacity-10"></div>
                                    <div class="position-relative z-2">
                                        <p class="opacity-75 mb-1 text-uppercase small ls-1">Estimated Monthly Payment</p>
                                        <h1 class="display-4 fw-bold text-success mb-3" id="monthlyPayment">KES 41,200</h1>
                                        
                                        <hr class="border-secondary opacity-25 my-4">
                                        
                                        <div class="row small opacity-75">
                                            <div class="col-6 text-end border-end border-secondary">
                                                Interest Rate<br><strong class="text-white">13% p.a</strong>
                                            </div>
                                            <div class="col-6 text-start ps-3">
                                                Loan Amount<br><strong class="text-white" id="loanAmount">KES 1,200,000</strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="apply" class="py-5 bg-white">
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center mb-5">
                <h2 class="fw-bold mb-3">Get Pre-Qualified</h2>
                <p class="lead text-muted">
                    Submit your details below. We filter your profile and match you with the <strong class="text-dark">Top 3 Saccos</strong> offering the best rates for your income bracket.
                </p>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card border border-light shadow-lg rounded-4 p-4 p-md-5">
                    <form method="POST">
                        {% csrf_token %}
                        <h5 class="fw-bold text-dark border-bottom pb-3 mb-4">Applicant Information</h5>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label small fw-bold text-uppercase text-muted">Full Name</label>
                                <input type="text" name="full_name" class="form-control p-3 bg-light border-0" required placeholder="As per ID">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small fw-bold text-uppercase text-muted">Phone Number</label>
                                <input type="tel" name="phone" class="form-control p-3 bg-light border-0" required placeholder="07...">
                            </div>
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label small fw-bold text-uppercase text-muted">Employment Status</label>
                                <select name="employment_status" class="form-select p-3 bg-light border-0" required>
                                    <option value="" selected disabled>Choose...</option>
                                    <option value="Employed">Employed (Salaried)</option>
                                    <option value="Business Owner">Self-Employed / Business</option>
                                    <option value="Diaspora">Diaspora Client</option>
                                    <option value="Corporate">Corporate / Company</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small fw-bold text-uppercase text-muted">Net Monthly Income</label>
                                <select name="monthly_income" class="form-select p-3 bg-light border-0" required>
                                    <option value="" selected disabled>Select Range...</option>
                                    <option value="50k-100k">KES 50,000 - 100,000</option>
                                    <option value="100k-300k">KES 100,000 - 300,000</option>
                                    <option value="300k-500k">KES 300,000 - 500,000</option>
                                    <option value="500k+">Above KES 500,000</option>
                                </select>
                            </div>
                        </div>

                        <h5 class="fw-bold text-dark border-bottom pb-3 mb-4 mt-5">Loan Requirements</h5>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label small fw-bold text-uppercase text-muted">Target Car Budget</label>
                                <div class="input-group">
                                    <span class="input-group-text border-0 bg-light">KES</span>
                                    <input type="number" name="car_budget" class="form-control p-3 bg-light border-0" placeholder="e.g. 1,500,000">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small fw-bold text-uppercase text-muted">Deposit Available</label>
                                <div class="input-group">
                                    <span class="input-group-text border-0 bg-light">KES</span>
                                    <input type="number" name="deposit_amount" class="form-control p-3 bg-light border-0" placeholder="e.g. 300,000">
                                </div>
                            </div>
                        </div>

                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" required id="consent">
                            <label class="form-check-label small text-muted" for="consent">
                                I agree to allow BuyCars.Africa to share this information with verified financial partners for pre-qualification purposes.
                            </label>
                        </div>

                        <button type="submit" class="btn btn-dark w-100 py-3 rounded-pill fw-bold shadow-lg hover-lift">
                            Submit Application <i class="fas fa-paper-plane ms-2"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-5 bg-light border-top">
    <div class="container text-center">
        <p class="small fw-bold text-uppercase text-muted mb-4">Our Institutional Partners</p>
        <div class="row justify-content-center opacity-50 grayscale-logos g-4">
            <div class="col-6 col-md-2 fw-bold text-dark h4">NCBA</div>
            <div class="col-6 col-md-2 fw-bold text-dark h4">CO-OP</div>
            <div class="col-6 col-md-2 fw-bold text-dark h4">KCB</div>
            <div class="col-6 col-md-2 fw-bold text-dark h4">STANBIC</div>
            <div class="col-6 col-md-2 fw-bold text-dark h4">I&M</div>
        </div>
    </div>
</section>

<script>
    function updateMonthsLabel() {
        const months = document.getElementById('months').value;
        document.getElementById('monthsLabel').innerText = months + " Months";
    }

    function calculateLoan() {
        const price = parseFloat(document.getElementById('carPrice').value) || 0;
        const deposit = parseFloat(document.getElementById('deposit').value) || 0;
        const months = parseInt(document.getElementById('months').value) || 36;
        const interestRate = 0.13; // 13% Annual Rate

        const principal = price - deposit;
        
        if (principal <= 0) {
            document.getElementById('monthlyPayment').innerText = "KES 0";
            document.getElementById('loanAmount').innerText = "KES 0";
            return;
        }

        // Simple Interest for rough estimation (Standard in rough car loan calculators)
        // Or PMT formula: P * r * (1 + r)^n / ((1 + r)^n - 1)
        const monthlyRate = interestRate / 12;
        const pmt = (principal * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -months));

        document.getElementById('monthlyPayment').innerText = "KES " + Math.round(pmt).toLocaleString();
        document.getElementById('loanAmount').innerText = "KES " + principal.toLocaleString();
    }

    // Run on load
    calculateLoan();
</script>

<style>
    .grayscale-logos { filter: grayscale(100%); transition: 0.3s; }
    .grayscale-logos:hover { filter: grayscale(0%); opacity: 1 !important; }
    .hover-lift:hover { transform: translateY(-3px); }
</style>
{% endblock %}